# Fraction Fun

El archivo code.txt es un conjunto de fracciones que el servidor usa para realizar operaciones sobre el numero introducido:
```
   4   │ def execute(code, inp):
   5   │     values = code.split(" ")
   6   │     inp = int(inp)
   7   │     a = [int(i.split("/")[0]) for i in values]
   8   │     b = [int(i.split("/")[1]) for i in values]
   9   │     broken = False
  10   │     for _ in range(1000):
  11   │         changed = False
  12   │         for i in range(len(a)):
  13   │             if inp % b[i] == 0:
  14   │                 inp = inp * a[i] // b[i]
  15   │                 changed = True
  16   │         if not changed:
  17   │             broken = True
  18   │             break
  19   │     if not broken:
  20   │         print("Loop did not terminate in 1000 iterations!")
  21   │         return inp
  22   │     return inp
  23   │
```
Agrega los numeradores al arreglo `a` y los denominadores al arreglo `b` e itera sobre ellos:

Si inp es divisible por el denominador, entonces inp = inp * numerador // denominador, asi hasta que inp no sea divisible por uno de los denominadores, entonces se retorna el valor actual inp

El resultado se compara con el numero en output.txt, si es asi se devuelve la flag:
```
  33   │         if out == int(fin_output):
  34   │             print("Correct!")
  35   │             print("Here is the flag: " + open("flag.txt", "r").read())
  36   │             break
```

La forma entendida de resolverlo es invertir las operaciones teniendo como punto de partida el resultado almacenado en output.txt y asi obtener la entrada correcta:

- Comprobar que el valor actual es multiplo de a[i], el numerador
- Si es asi valor_actual = valor_actual * b[i] // a[i]
- Continuar hasta que el valor actual no sea multiplo de a[i]

``` python
cat rev.py
def reverse_execute(code, output):
    values = code.split(" ")
    a = [int(i.split("/")[0]) for i in values]
    b = [int(i.split("/")[1]) for i in values]
    inp = output
    changed = True
    while changed:
        changed = False
        for i in range(len(a)):
            if inp % a[i] == 0:
                inp = inp * b[i] // a[i]
                changed = True
    return inp


code = open("code.txt", "r").read()
output = 26583695521295564229597702539606779011424487630673118238848488250483324638316493786570869155140262109049480728720762458861072382684496180304334780580927278480859828726271190354563801424026577071092295383902034809987118743623980912225475900244424293925091408859063688998972149202047364837931904804899042122574503994569600746938637960913073394707892294153090918898328022107247581272863802253341432320938165400233000775086785908939290420113613066550342438527239433033068361060160630630082143980259608478649688184001887031227134526555373378453043380082886248214045569103863602855235129007027468851693345088850218355279083544799043710805153297299609903475798568030451596050516808739152859459909989354534948107258456557490085460286436562247329508838657444598086742992481999935339366611914188475448009484000721883947866826487274989647499669472627139328680685664054694766806899629567782668520200835436391615456137547263096541357115999084091125914898574531262690211384194317518215317516788665114719421885068620084565914276013819753391228437274756802904194382475006545796394208126066131704391781275616585871926844307150203052130711672595603719081095076166720941879003314070745909826291196703785409557136061565397541026718608726589513196689900333744709590748515676202353872332605737968135033

print(reverse_execute(code,output))
```

```
> python3 rev.py
81363009975812384722694479132411347799660855995041102046135652085946627267719600429435186325382591100137317802722335448123122062681910908311142779694693294683691452498840321155558324849643332989287463292772337583288252027860088440052416525733341168754245468576247805570871677466462505394398446449551935313297511282365984228590257068951404532826792052093463067309084117522743746657511529873363816352818650824281327073174499470053290105757303242995552756051621897174860995045710945811014867263742897278125

> nc challs.breachers.in 13337
Input your number: 81363009975812384722694479132411347799660855995041102046135652085946627267719600429435186325382591100137317802722335448123122062681910908311142779694693294683691452498840321155558324849643332989287463292772337583288252027860088440052416525733341168754245468576247805570871677466462505394398446449551935313297511282365984228590257068951404532826792052093463067309084117522743746657511529873363816352818650824281327073174499470053290105757303242995552756051621897174860995045710945811014867263742897278125
Correct!
Here is the flag: Breach{0n3_0f_c0nw4y5_7ur1n6_c0mpl373_w0nd3r5}

Bye Bye!
```

Otra forma es simplemente pasar el mismo valor esperado como entrada. Como no es multiplo de 2 (el primer divisor) entonces no cambia y la validacion funciona :)

```
> nc challs.breachers.in 13337
Input your number: 26583695521295564229597702539606779011424487630673118238848488250483324638316493786570869155140262109049480728720762458861072382684496180304334780580927278480859828726271190354563801424026577071092295383902034809987118743623980912225475900244424293925091408859063688998972149202047364837931904804899042122574503994569600746938637960913073394707892294153090918898328022107247581272863802253341432320938165400233000775086785908939290420113613066550342438527239433033068361060160630630082143980259608478649688184001887031227134526555373378453043380082886248214045569103863602855235129007027468851693345088850218355279083544799043710805153297299609903475798568030451596050516808739152859459909989354534948107258456557490085460286436562247329508838657444598086742992481999935339366611914188475448009484000721883947866826487274989647499669472627139328680685664054694766806899629567782668520200835436391615456137547263096541357115999084091125914898574531262690211384194317518215317516788665114719421885068620084565914276013819753391228437274756802904194382475006545796394208126066131704391781275616585871926844307150203052130711672595603719081095076166720941879003314070745909826291196703785409557136061565397541026718608726589513196689900333744709590748515676202353872332605737968135033
Correct!
Here is the flag: Breach{0n3_0f_c0nw4y5_7ur1n6_c0mpl373_w0nd3r5}

Bye Bye!
```

`Breach{0n3_0f_c0nw4y5_7ur1n6_c0mpl373_w0nd3r5}`
